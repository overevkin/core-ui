<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Comindware UI-Core API Source: form/editors/NumberEditorView.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.cerulean.css">

</head>

<body>
<div class="container-fluid">
	<div class="navbar navbar-fixed-top navbar-inverse">
		<div class="navbar-inner">
			<a class="brand" href="index.html">Comindware UI-Core API</a>
			<ul class="nav">
				
				<li class="dropdown">
					<a href="namespaces.list.html" class="dropdown-toggle" data-toggle="dropdown">Namespaces<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="module-core.collections.html">core.collections</a>
						</li>
						
						<li>
							<a href="module-core.collections.behaviors.html">core.collections.behaviors</a>
						</li>
						
						<li>
							<a href="module-core.dropdown.html">core.dropdown</a>
						</li>
						
						<li>
							<a href="module-core.dropdown.factory.html">core.dropdown.factory</a>
						</li>
						
						<li>
							<a href="module-core.dropdown.views.html">core.dropdown.views</a>
						</li>
						
						<li>
							<a href="module-core.dropdown.views.behaviors.html">core.dropdown.views.behaviors</a>
						</li>
						
						<li>
							<a href="module-core.form.html">core.form</a>
						</li>
						
						<li>
							<a href="module-core.form.behaviors.html">core.form.behaviors</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.html">core.form.editors</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.base.html">core.form.editors.base</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.reference.html">core.form.editors.reference</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.reference.controllers.html">core.form.editors.reference.controllers</a>
						</li>
						
						<li>
							<a href="module-core.form.fields.html">core.form.fields</a>
						</li>
						
						<li>
							<a href="module-core.list.html">core.list</a>
						</li>
						
						<li>
							<a href="module-core.list.cellFactory.html">core.list.cellFactory</a>
						</li>
						
						<li>
							<a href="module-core.list.factory.html">core.list.factory</a>
						</li>
						
						<li>
							<a href="module-core.list.models.html">core.list.models</a>
						</li>
						
						<li>
							<a href="module-core.list.views.html">core.list.views</a>
						</li>
						
						<li>
							<a href="module-core.meta.html">core.meta</a>
						</li>
						
						<li>
							<a href="module-core.models.html">core.models</a>
						</li>
						
						<li>
							<a href="module-core.nativeGrid.html">core.nativeGrid</a>
						</li>
						
						<li>
							<a href="module-core.nativeGrid.factory.html">core.nativeGrid.factory</a>
						</li>
						
						<li>
							<a href="module-core.nativeGrid.filterViewFactory.html">core.nativeGrid.filterViewFactory</a>
						</li>
						
						<li>
							<a href="module-core.nativeGrid.views.html">core.nativeGrid.views</a>
						</li>
						
						<li>
							<a href="module-core.services.html">core.services</a>
						</li>
						
						<li>
							<a href="module-core.utils.html">core.utils</a>
						</li>
						
						<li>
							<a href="module-core.utils.comparators.html">core.utils.comparators</a>
						</li>
						
						<li>
							<a href="module-core.utils.cookieHelpers.html">core.utils.cookieHelpers</a>
						</li>
						
						<li>
							<a href="module-core.utils.dateHelpers.html">core.utils.dateHelpers</a>
						</li>
						
						<li>
							<a href="module-core.utils.helpers.html">core.utils.helpers</a>
						</li>
						
						<li>
							<a href="module-core.utils.htmlHelpers.html">core.utils.htmlHelpers</a>
						</li>
						
						<li>
							<a href="module-core.utils.keyCode.html">core.utils.keyCode</a>
						</li>
						

					</ul>
				</li>
				
				<li class="dropdown">
					<a href="modules.list.html" class="dropdown-toggle" data-toggle="dropdown">Modules<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="module-core.html">core</a>
						</li>
						

					</ul>
				</li>
				
				<li class="dropdown">
					<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="module-core.collection.behaviors.HighlightableBehavior.html">core.collection.behaviors.HighlightableBehavior</a>
						</li>
						
						<li>
							<a href="module-core.collections.SlidingWindowCollection.html">core.collections.SlidingWindowCollection</a>
						</li>
						
						<li>
							<a href="module-core.collections.VirtualCollection.html">core.collections.VirtualCollection</a>
						</li>
						
						<li>
							<a href="module-core.dropdown.views.behaviors.CustomAnchorBehavior.html">core.dropdown.views.behaviors.CustomAnchorBehavior</a>
						</li>
						
						<li>
							<a href="module-core.dropdown.views.DefaultButtonView.html">core.dropdown.views.DefaultButtonView</a>
						</li>
						
						<li>
							<a href="module-core.dropdown.views.DropdownView.html">core.dropdown.views.DropdownView</a>
						</li>
						
						<li>
							<a href="module-core.dropdown.views.ListPanelView.html">core.dropdown.views.ListPanelView</a>
						</li>
						
						<li>
							<a href="module-core.dropdown.views.MenuItemView.html">core.dropdown.views.MenuItemView</a>
						</li>
						
						<li>
							<a href="module-core.dropdown.views.MenuPanelView.html">core.dropdown.views.MenuPanelView</a>
						</li>
						
						<li>
							<a href="module-core.dropdown.views.PopoutView.html">core.dropdown.views.PopoutView</a>
						</li>
						
						<li>
							<a href="module-core.form.behaviors.BackboneFormBehavior.html">core.form.behaviors.BackboneFormBehavior</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.base.BaseEditorView.html">core.form.editors.base.BaseEditorView</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.BooleanEditorView.html">core.form.editors.BooleanEditorView</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.DateEditorView.html">core.form.editors.DateEditorView</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.DateTimeEditorView.html">core.form.editors.DateTimeEditorView</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.DropdownEditorView.html">core.form.editors.DropdownEditorView</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.DurationEditorView.html">core.form.editors.DurationEditorView</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.MembersBubbleEditorView.html">core.form.editors.MembersBubbleEditorView</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.MemberSelectEditorView.html">core.form.editors.MemberSelectEditorView</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.MentionEditorView.html">core.form.editors.MentionEditorView</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.MultiSelectEditorView.html">core.form.editors.MultiSelectEditorView</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.NumberEditorView.html">core.form.editors.NumberEditorView</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.PasswordEditorView.html">core.form.editors.PasswordEditorView</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.RadioGroupEditorView.html">core.form.editors.RadioGroupEditorView</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.reference.controllers.BaseReferenceEditorController.html">core.form.editors.reference.controllers.BaseReferenceEditorController</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.ReferenceEditorView.html">core.form.editors.ReferenceEditorView</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.TextAreaEditorView.html">core.form.editors.TextAreaEditorView</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.TextEditorView.html">core.form.editors.TextEditorView</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.TimeEditorView.html">core.form.editors.TimeEditorView</a>
						</li>
						
						<li>
							<a href="module-core.form.ExtendedForm.html">core.form.ExtendedForm</a>
						</li>
						
						<li>
							<a href="module-core.list.models.LoadingRowModel.html">core.list.models.LoadingRowModel</a>
						</li>
						
						<li>
							<a href="module-core.list.views.EmptyGridView.html">core.list.views.EmptyGridView</a>
						</li>
						
						<li>
							<a href="module-core.list.views.EmptyListView.html">core.list.views.EmptyListView</a>
						</li>
						
						<li>
							<a href="module-core.list.views.GridColumnHeaderView.html">core.list.views.GridColumnHeaderView</a>
						</li>
						
						<li>
							<a href="module-core.list.views.GridHeaderView.html">core.list.views.GridHeaderView</a>
						</li>
						
						<li>
							<a href="module-core.list.views.GridView.html">core.list.views.GridView</a>
						</li>
						
						<li>
							<a href="module-core.list.views.ListView.html">core.list.views.ListView</a>
						</li>
						
						<li>
							<a href="module-core.list.views.LoadingRowView.html">core.list.views.LoadingRowView</a>
						</li>
						
						<li>
							<a href="module-core.list.views.NoColumnsView.html">core.list.views.NoColumnsView</a>
						</li>
						
						<li>
							<a href="module-core.list.views.RowView.html">core.list.views.RowView</a>
						</li>
						
						<li>
							<a href="module-core.list.views.ScrollBarView.html">core.list.views.ScrollBarView</a>
						</li>
						
						<li>
							<a href="module-core.nativeGrid.views.ColumnHeaderView.html">core.nativeGrid.views.ColumnHeaderView</a>
						</li>
						
						<li>
							<a href="module-core.nativeGrid.views.HeaderView.html">core.nativeGrid.views.HeaderView</a>
						</li>
						
						<li>
							<a href="module-core.nativeGrid.views.ListView.html">core.nativeGrid.views.ListView</a>
						</li>
						
						<li>
							<a href="module-core.nativeGrid.views.NativeGridView.html">core.nativeGrid.views.NativeGridView</a>
						</li>
						
						<li>
							<a href="module-core.nativeGrid.views.RowView.html">core.nativeGrid.views.RowView</a>
						</li>
						

					</ul>
				</li>
				
			</ul>
		</div>
	</div>

	<div class="row-fluid">

		
			<div class="span12">
				
				<div id="main">
					


		<h1 class="page-title">Source: form/editors/NumberEditorView.js</h1>
    
<section>
	<article>
		<pre
			class="sunlight-highlight-javascript linenums">/**
 * Developer: Stepan Burguchev
 * Date: 10/3/2014
 * Copyright: 2009-2016 Comindware®
 *       All Rights Reserved
 * Published under the MIT license
 */

/* global define, require, Handlebars, Backbone, Marionette, $, _ */

define(['text!./templates/numberEditor.html', './base/BaseItemEditorView', 'core/libApi', 'core/utils/utilsApi'],
    function (template, BaseItemEditorView, lib, utils) {
        'use strict';

        var changeMode = {
            keydown: 'keydown',
            blur: 'blur'
        };

        var constants = {
            STEP: 1,
            PAGE: 10,
            INCREMENTAL: true
        };

        var defaultOptions = {
            max: null,
            min: 0,
            allowFloat: false,
            changeMode: changeMode.blur
        };

        var keyCode = utils.keyCode;

        var allowedKeys = [
            keyCode.DELETE,
            keyCode.BACKSPACE,
            keyCode.TAB,
            keyCode.ESCAPE,
            keyCode.ENTER,
            keyCode.NUMPAD_ENTER,
            keyCode.NUMPAD_DECIMAL,
            keyCode.PERIOD,
            keyCode.HOME,
            keyCode.END,
            keyCode.RIGHT,
            keyCode.LEFT,
            keyCode.UP,
            keyCode.DOWN,
            keyCode.SUBTRACT,
            keyCode.NUMPAD_SUBTRACT
        ];

        /**
         * @name NumberEditorView
         * @memberof module:core.form.editors
         * @class Редактор числовых значений. Поддерживаемый тип данных: &lt;code>Number&lt;/code>.
         * @extends module:core.form.editors.base.BaseEditorView
         * @param {Object} options Объект опций. Также поддерживаются все опции базового класса
         * {@link module:core.form.editors.base.BaseEditorView BaseEditorView}.
         * @param {Boolean} [options.allowFloat=false] Если &lt;code>true&lt;/code>, ко вводу допускаются значения с плавающей точкой.
         * @param {String} [options.changeMode='blur'] Определяет момент обновления значения редактора:&lt;ul>
         *     &lt;li>&lt;code>'keydown'&lt;/code> - при нажатии клавиши.&lt;/li>
         *     &lt;li>&lt;code>'blur'&lt;/code> - при потери фокуса.&lt;/li>&lt;/ul>
         * @param {Number} [options.max=null] Максимальное возможное значение. Если &lt;code>null&lt;/code>, не ограничено.
         * @param {Number} [options.min=0] Минимальное возможное значение. Если &lt;code>null&lt;/code>, не ограничено.
         * */
        Backbone.Form.editors.Number = BaseItemEditorView.extend(/** @lends module:core.form.editors.NumberEditorView.prototype */{
            initialize: function (options) {
                if (options.schema) {
                    _.extend(this.options, defaultOptions, _.pick(options.schema, _.keys(defaultOptions)));
                } else {
                    _.extend(this.options, defaultOptions, _.pick(options || {}, _.keys(defaultOptions)));
                }
                _.bindAll(this, '__stop');
            },

            template: Handlebars.compile(template),

            focusElement: '.js-input',

            className: 'l-field l-field_number',

            ui: {
                input: '.js-input',
                spinnerUp: '.js-spinner-up',
                spinnerDown: '.js-spinner-down',
                spinnerButtons: '.js-spinner-button'
            },

            events: {
                'keydown @ui.input': '__keydown',
                'keyup @ui.input': function (event) {
                    if ([keyCode.UP, keyCode.DOWN, keyCode.PAGE_UP, keyCode.PAGE_DOWN].indexOf(event.keyCode) !== -1) {
                        this.__stop();
                    }
                    if (this.options.changeMode === changeMode.keydown) {
                        this.__value(this.ui.input.val(), true, true, false);
                    }
                },
                'change @ui.input': function () {
                    this.__value(this.ui.input.val(), false, true, false);
                },
                'mousewheel @ui.input': function (event) {
                    if (!this.getEnabled() || this.getReadonly() || !this.hasFocus) {
                        return;
                    }

                    this.__start();
                    this.__spin((event.deltaY > 0 ? 1 : -1) * constants.STEP);
                    clearTimeout(this.mousewheelTimer);
                    //noinspection JSCheckFunctionSignatures
                    this.mousewheelTimer = setTimeout(this.__stop, 100);
                    return false;
                },
                'mousedown @ui.spinnerUp': function (event) {
                    event.preventDefault();
                    this.focus();
                    this.__setActive(this.ui.spinnerDown, true);
                    this.__start();
                    this.__repeat(null, 1);
                },
                'mousedown @ui.spinnerDown': function (event) {
                    event.preventDefault();
                    this.focus();
                    this.__setActive(this.ui.spinnerUp, true);
                    this.__start();
                    this.__repeat(null, -1);
                },
                "mouseup @ui.spinnerButtons": "__stop",
                'mouseleave @ui.spinnerButtons': '__stop'
            },

            onRender: function () {
               this.__value(this.value, false, false, true);
            },

            __setActive: function (el, isActive) {
                if (isActive) {
                    $(el).addClass('ui-state-active');
                } else {
                    $(el).removeClass('ui-state-active');
                }
            },

            setPermissions: function (enabled, readonly) {
                BaseItemEditorView.prototype.setPermissions.call(this, enabled, readonly);
                if (enabled && !readonly) {
                    this.ui.spinnerUp.show();
                    this.ui.spinnerDown.show();
                } else {
                    this.ui.spinnerUp.hide();
                    this.ui.spinnerDown.hide();
                }
            },

            __setEnabled: function (enabled) {
                BaseItemEditorView.prototype.__setEnabled.call(this, enabled);
                this.ui.input.prop('disabled', !enabled);
            },

            __setReadonly: function (readonly) {
                BaseItemEditorView.prototype.__setReadonly.call(this, readonly);
                if (this.getEnabled()) {
                    this.ui.input.prop('readonly', readonly);
                }
            },

            __repeat: function(i, steps) {
                i = i || 500;

                clearTimeout(this.timer);
                this.timer = setTimeout(function() {
                    this.__repeat(40, steps);
                }.bind(this), i);

                this.__spin(steps * constants.STEP);
            },

            __keydown: function(event) {
                this.__start();
                var options = this.options;

                switch (event.keyCode) {
                case keyCode.UP:
                    this.__repeat(null, 1, event);
                    return false;
                case keyCode.DOWN:
                    this.__repeat(null, -1, event);
                    return false;
                case keyCode.PAGE_UP:
                    this.__repeat(null, constants.PAGE, event);
                    return false;
                case keyCode.PAGE_DOWN:
                    this.__repeat(null, -constants.PAGE, event);
                    return false;
                }

                if (event.ctrlKey === true || allowedKeys.indexOf(event.keyCode) !== -1) {
                    return true;
                }

                var charValue = null;
                if (event.keyCode >= keyCode.NUM_0 && event.keyCode &lt;= keyCode.NUM_9) {
                    charValue = event.keyCode - keyCode.NUM_0;
                } else if (event.keyCode >= keyCode.NUMPAD_0 && event.keyCode &lt;= keyCode.NUMPAD_9) {
                    charValue = event.keyCode - keyCode.NUMPAD_0;
                }
                var valid = charValue !== null;
                if (!valid) {
                    return false;
                }
            },
            
            __start: function() {
                if (!this.counter) {
                    this.counter = 1;
                }
                this.spinning = true;
            },

            __spin: function(step) {
                var value = this.getValue() || 0;

                if (!this.counter) {
                    this.counter = 1;
                }

                value = this.__adjustValue(value + step * this.__increment(this.counter));
                this.__value(value, false, true, false);
                this.counter++;
            },

            __stop: function() {
                if (!this.spinning) {
                    return;
                }

                this.__setActive(this.ui.spinnerButtons, false);
                clearTimeout(this.timer);
                clearTimeout(this.mousewheelTimer);
                this.counter = 0;
                this.spinning = false;
            },

            __value: function(value, suppressRender, triggerChange, force) {
                if (value === this.value && !force) {
                    return;
                }
                var parsed;
                if (value !== "" && value !== null) {
                    parsed = this.__parse(value);
                    if (parsed !== null) {
                        value = this.__adjustRange(parsed);
                        if (!this.options.allowFloat) {
                            value = Math.floor(value);
                        }
                    } else {
                        return;
                    }
                } else if (value === "") {
                    value = null;
                }

                this.value = value;
                if (!suppressRender) {
                    this.ui.input.val(value);
                }
                if (triggerChange) {
                    this.__triggerChange();
                }
            },

            __parse: function (val) {
                if (typeof val === "string" && val !== "") {
                    val = Number(val);
                    if (val === Number.POSITIVE_INFINITY) {
                        val = Number.MAX_VALUE;
                    } else if (val === Number.NEGATIVE_INFINITY) {
                        val = Number.MIN_VALUE;
                    }
                }
                return val === "" || isNaN(val) ? null : val;
            },

            __precision: function() {
                var precision = this.__precisionOf(constants.STEP);
                if (this.options.min !== null) {
                    precision = Math.max(precision, this.__precisionOf(this.options.min));
                }
                return precision;
            },

            __precisionOf: function(num) {
                var str = num.toString();
                var decimal = str.indexOf(".");
                return decimal === -1 ? 0 : str.length - decimal - 1;
            },

            __increment: function(i) {
                var incremental = constants.INCREMENTAL;
                if (incremental) {
                    return $.isFunction(incremental) ?
                        incremental(i) :
                        Math.floor(i*i*i/50000 - i*i/500 + 17*i/200 + 1);
                }
                return 1;
            },

            __adjustRange: function (value) {
                var options = this.options;
                if (options.max !== null && value > options.max) {
                    return options.max;
                }
                if (options.min !== null && value &lt; options.min) {
                    return options.min;
                }
                return value;
            },

            __adjustValue: function(value) {
                var base, aboveMin,
                    options = this.options;

                // make sure we're at a valid step
                // - find out where we are relative to the base (min or 0)
                base = options.min !== null ? options.min : 0;
                aboveMin = value - base;
                // - round to the nearest step
                aboveMin = Math.round(aboveMin / constants.STEP) * constants.STEP;
                // - rounding is based on 0, so adjust back to our base
                value = base + aboveMin;

                // fix precision from bad JS floating point math
                value = parseFloat(value.toFixed(this.__precision()));

                return value;
            },

            setValue: function(value) {
                this.__value(value, false, false, false);
            }
        });

        return Backbone.Form.editors.Number;
    });
</pre>
	</article>
</section>





				</div>

				<div class="clearfix"></div>
				<footer>
					
					
		<span class="copyright">
		Comindware Copyright © 2015
		</span>
					<br />
					
		<span class="jsdoc-message">
		Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a>
		on Thu Dec 17th 2015 using the <a
			href="https://github.com/terryweiss/docstrap">DocStrap template</a>.
		</span>
				</footer>
			</div>

			
			<br clear="both">
		</div>

	</div>
	<!--<script src="scripts/sunlight.js"></script>-->
	<script src="scripts/docstrap.lib.js"></script>
	<script src="scripts/bootstrap-dropdown.js"></script>
	<script src="scripts/toc.js"></script>

	<script>
		$( function () {
			$( "[id*='$']" ).each( function () {
				var $this = $( this );

				$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
			} );

			$( "#toc" ).toc( {
				anchorName  : function ( i, heading, prefix ) {
					return $( heading ).attr( "id" ) || ( prefix + i );
				},
				selectors   : "h1,h2,h3,h4",
				showAndHide : false,
				scrollTo    : "100px"
			} );

			$( "#toc>ul" ).addClass( "nav nav-pills nav-stacked" );
			$( "#main span[id^='toc']" ).addClass( "toc-shim" );
			$( '.dropdown-toggle' ).dropdown();
//			$( ".tutorial-section pre, .readme-section pre" ).addClass( "sunlight-highlight-javascript" ).addClass( "linenums" );

			$( ".tutorial-section pre, .readme-section pre" ).each( function () {
				var $this = $( this );

				var example = $this.find( "code" );
				exampleText = example.html();
				var lang = /{@lang (.*?)}/.exec( exampleText );
				if ( lang && lang[1] ) {
					exampleText = exampleText.replace( lang[0], "" );
					example.html( exampleText );
					lang = lang[1];
				} else {
					lang = "javascript";
				}

				if ( lang ) {

					$this
						.addClass( "sunlight-highlight-" + lang )
						.addClass( "linenums" )
						.html( example.html() );

				}
			} );

			Sunlight.highlightAll( {
				lineNumbers : true,
				showMenu : true,
				enableDoclinks : true
			} );
		} );
	 </script>



	<!--Navigation and Symbol Display-->
	


	<!--Google Analytics-->
	

</body>
</html>
