<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Comindware UI-Core API Source: nativeGrid/views/ListView.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.cerulean.css">

</head>

<body>
<div class="container-fluid">
	<div class="navbar navbar-fixed-top navbar-inverse">
		<div class="navbar-inner">
			<a class="brand" href="index.html">Comindware UI-Core API</a>
			<ul class="nav">
				
				<li class="dropdown">
					<a href="namespaces.list.html" class="dropdown-toggle" data-toggle="dropdown">Namespaces<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="module-core.collections.html">core.collections</a>
						</li>
						
						<li>
							<a href="module-core.collections.behaviors.html">core.collections.behaviors</a>
						</li>
						
						<li>
							<a href="module-core.dropdown.html">core.dropdown</a>
						</li>
						
						<li>
							<a href="module-core.dropdown.factory.html">core.dropdown.factory</a>
						</li>
						
						<li>
							<a href="module-core.dropdown.views.html">core.dropdown.views</a>
						</li>
						
						<li>
							<a href="module-core.dropdown.views.behaviors.html">core.dropdown.views.behaviors</a>
						</li>
						
						<li>
							<a href="module-core.form.html">core.form</a>
						</li>
						
						<li>
							<a href="module-core.form.behaviors.html">core.form.behaviors</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.html">core.form.editors</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.base.html">core.form.editors.base</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.reference.html">core.form.editors.reference</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.reference.controllers.html">core.form.editors.reference.controllers</a>
						</li>
						
						<li>
							<a href="module-core.form.fields.html">core.form.fields</a>
						</li>
						
						<li>
							<a href="module-core.list.html">core.list</a>
						</li>
						
						<li>
							<a href="module-core.list.cellFactory.html">core.list.cellFactory</a>
						</li>
						
						<li>
							<a href="module-core.list.factory.html">core.list.factory</a>
						</li>
						
						<li>
							<a href="module-core.list.models.html">core.list.models</a>
						</li>
						
						<li>
							<a href="module-core.list.views.html">core.list.views</a>
						</li>
						
						<li>
							<a href="module-core.meta.html">core.meta</a>
						</li>
						
						<li>
							<a href="module-core.models.html">core.models</a>
						</li>
						
						<li>
							<a href="module-core.nativeGrid.html">core.nativeGrid</a>
						</li>
						
						<li>
							<a href="module-core.nativeGrid.factory.html">core.nativeGrid.factory</a>
						</li>
						
						<li>
							<a href="module-core.nativeGrid.filterViewFactory.html">core.nativeGrid.filterViewFactory</a>
						</li>
						
						<li>
							<a href="module-core.nativeGrid.views.html">core.nativeGrid.views</a>
						</li>
						
						<li>
							<a href="module-core.services.html">core.services</a>
						</li>
						
						<li>
							<a href="module-core.utils.html">core.utils</a>
						</li>
						
						<li>
							<a href="module-core.utils.comparators.html">core.utils.comparators</a>
						</li>
						
						<li>
							<a href="module-core.utils.cookieHelpers.html">core.utils.cookieHelpers</a>
						</li>
						
						<li>
							<a href="module-core.utils.dateHelpers.html">core.utils.dateHelpers</a>
						</li>
						
						<li>
							<a href="module-core.utils.helpers.html">core.utils.helpers</a>
						</li>
						
						<li>
							<a href="module-core.utils.htmlHelpers.html">core.utils.htmlHelpers</a>
						</li>
						
						<li>
							<a href="module-core.utils.keyCode.html">core.utils.keyCode</a>
						</li>
						

					</ul>
				</li>
				
				<li class="dropdown">
					<a href="modules.list.html" class="dropdown-toggle" data-toggle="dropdown">Modules<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="module-core.html">core</a>
						</li>
						

					</ul>
				</li>
				
				<li class="dropdown">
					<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="module-core.collection.behaviors.HighlightableBehavior.html">core.collection.behaviors.HighlightableBehavior</a>
						</li>
						
						<li>
							<a href="module-core.collections.SlidingWindowCollection.html">core.collections.SlidingWindowCollection</a>
						</li>
						
						<li>
							<a href="module-core.collections.VirtualCollection.html">core.collections.VirtualCollection</a>
						</li>
						
						<li>
							<a href="module-core.dropdown.views.behaviors.CustomAnchorBehavior.html">core.dropdown.views.behaviors.CustomAnchorBehavior</a>
						</li>
						
						<li>
							<a href="module-core.dropdown.views.DefaultButtonView.html">core.dropdown.views.DefaultButtonView</a>
						</li>
						
						<li>
							<a href="module-core.dropdown.views.DropdownView.html">core.dropdown.views.DropdownView</a>
						</li>
						
						<li>
							<a href="module-core.dropdown.views.ListPanelView.html">core.dropdown.views.ListPanelView</a>
						</li>
						
						<li>
							<a href="module-core.dropdown.views.MenuItemView.html">core.dropdown.views.MenuItemView</a>
						</li>
						
						<li>
							<a href="module-core.dropdown.views.MenuPanelView.html">core.dropdown.views.MenuPanelView</a>
						</li>
						
						<li>
							<a href="module-core.dropdown.views.PopoutView.html">core.dropdown.views.PopoutView</a>
						</li>
						
						<li>
							<a href="module-core.form.behaviors.BackboneFormBehavior.html">core.form.behaviors.BackboneFormBehavior</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.base.BaseEditorView.html">core.form.editors.base.BaseEditorView</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.BooleanEditorView.html">core.form.editors.BooleanEditorView</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.DateEditorView.html">core.form.editors.DateEditorView</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.DateTimeEditorView.html">core.form.editors.DateTimeEditorView</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.DropdownEditorView.html">core.form.editors.DropdownEditorView</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.DurationEditorView.html">core.form.editors.DurationEditorView</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.MembersBubbleEditorView.html">core.form.editors.MembersBubbleEditorView</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.MemberSelectEditorView.html">core.form.editors.MemberSelectEditorView</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.MentionEditorView.html">core.form.editors.MentionEditorView</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.MultiSelectEditorView.html">core.form.editors.MultiSelectEditorView</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.NumberEditorView.html">core.form.editors.NumberEditorView</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.PasswordEditorView.html">core.form.editors.PasswordEditorView</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.RadioGroupEditorView.html">core.form.editors.RadioGroupEditorView</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.reference.controllers.BaseReferenceEditorController.html">core.form.editors.reference.controllers.BaseReferenceEditorController</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.ReferenceEditorView.html">core.form.editors.ReferenceEditorView</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.TextAreaEditorView.html">core.form.editors.TextAreaEditorView</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.TextEditorView.html">core.form.editors.TextEditorView</a>
						</li>
						
						<li>
							<a href="module-core.form.editors.TimeEditorView.html">core.form.editors.TimeEditorView</a>
						</li>
						
						<li>
							<a href="module-core.form.ExtendedForm.html">core.form.ExtendedForm</a>
						</li>
						
						<li>
							<a href="module-core.list.models.LoadingRowModel.html">core.list.models.LoadingRowModel</a>
						</li>
						
						<li>
							<a href="module-core.list.views.EmptyGridView.html">core.list.views.EmptyGridView</a>
						</li>
						
						<li>
							<a href="module-core.list.views.EmptyListView.html">core.list.views.EmptyListView</a>
						</li>
						
						<li>
							<a href="module-core.list.views.GridColumnHeaderView.html">core.list.views.GridColumnHeaderView</a>
						</li>
						
						<li>
							<a href="module-core.list.views.GridHeaderView.html">core.list.views.GridHeaderView</a>
						</li>
						
						<li>
							<a href="module-core.list.views.GridView.html">core.list.views.GridView</a>
						</li>
						
						<li>
							<a href="module-core.list.views.ListView.html">core.list.views.ListView</a>
						</li>
						
						<li>
							<a href="module-core.list.views.LoadingRowView.html">core.list.views.LoadingRowView</a>
						</li>
						
						<li>
							<a href="module-core.list.views.NoColumnsView.html">core.list.views.NoColumnsView</a>
						</li>
						
						<li>
							<a href="module-core.list.views.RowView.html">core.list.views.RowView</a>
						</li>
						
						<li>
							<a href="module-core.list.views.ScrollBarView.html">core.list.views.ScrollBarView</a>
						</li>
						
						<li>
							<a href="module-core.nativeGrid.views.ColumnHeaderView.html">core.nativeGrid.views.ColumnHeaderView</a>
						</li>
						
						<li>
							<a href="module-core.nativeGrid.views.HeaderView.html">core.nativeGrid.views.HeaderView</a>
						</li>
						
						<li>
							<a href="module-core.nativeGrid.views.ListView.html">core.nativeGrid.views.ListView</a>
						</li>
						
						<li>
							<a href="module-core.nativeGrid.views.NativeGridView.html">core.nativeGrid.views.NativeGridView</a>
						</li>
						
						<li>
							<a href="module-core.nativeGrid.views.RowView.html">core.nativeGrid.views.RowView</a>
						</li>
						

					</ul>
				</li>
				
			</ul>
		</div>
	</div>

	<div class="row-fluid">

		
			<div class="span12">
				
				<div id="main">
					


		<h1 class="page-title">Source: nativeGrid/views/ListView.js</h1>
    
<section>
	<article>
		<pre
			class="sunlight-highlight-javascript linenums">/**
 * Developer: Grigory Kuznetsov
 * Date: 17.08.2015
 * Copyright: 2009-2016 Comindware®
 *       All Rights Reserved
 * Published under the MIT license
 */

/* global define, require, Marionette, _, Handlebars, classes, shared, $ */

define([
        'core/libApi',
        'core/utils/utilsApi',
        'text!core/list/templates/list.html'
    ],
    function (lib, utils, template) {
        'use strict';

        var VisibleCollectionView = Marionette.CollectionView.extend({
            getChildView: function(child) {
                if (child.get('isLoadingRowModel'))
                {
                    return this.getOption('loadingChildView');
                }

                var childViewSelector = this.getOption('childViewSelector');
                if (childViewSelector) {
                    return childViewSelector(child);
                }

                var childView = this.getOption('childView');
                if (!childView) {
                    utils.helpers.throwInvalidOperationError('ListView: you must specify either \'childView\' or \'childViewSelector\' option.');
                }
                return childView;
            },

            setFitToView: function () {
                this.children.each(function (ch) {
                    ch.setFitToView();
                });
            }
        });

        /**
         * Some description for initializer
         * @name ListView
         * @memberof module:core.nativeGrid.views
         * @class ListView
         * @description View контента списка
         * @extends Marionette.LayoutView
         * @param {Object} options Constructor options
         * @param {Backbone.View} options.childView view Строки списка
         * @param {Function} [options.childViewSelector] ?
         * @param {Backbone.View} options.emptyView View для отображения пустого списка (нет строк)
         * @param {Object} [options.emptyViewOptions] Опции для emptyView
         * @param {Backbone.View} options.loadingChildView View-лоадер, показывается при подгрузке строк
         * */
        var ListView = Marionette.LayoutView.extend({
            initialize: function (options) {
                utils.helpers.ensureOption(options, 'collection');

                this.__createReqres();

                this.childViewOptions = _.extend(options.childViewOptions || {}, {
                    internalListViewReqres: this.internalReqres
                });

                options.childViewOptions && (this.childViewOptions = options.childViewOptions); // jshint ignore:line
                options.emptyView && (this.emptyView = options.emptyView); // jshint ignore:line
                options.emptyViewOptions && (this.emptyViewOptions = options.emptyViewOptions); // jshint ignore:line
                options.childView && (this.childView = options.childView); // jshint ignore:line
                options.childViewSelector && (this.childViewSelector = options.childViewSelector); // jshint ignore:line
                options.loadingChildView && (this.loadingChildView = options.loadingChildView);// jshint ignore:line

                this.state = {
                    position: 0
                };

                _.bindAll(this, '__handleResize', '__handleResizeInternal');
                $(window).resize(this.__handleResize);
            },

            regions: {
                visibleCollectionRegion: '.visible-collection-view'
            },

            className: 'list',
            template: Handlebars.compile(template),

            onShow: function () {
                this.state.visibleHeight = this.$el.parent().height();
                // Updating viewportHeight and rendering subviews
                this.visibleCollectionView = new VisibleCollectionView({
                    childView: this.childView,
                    childViewSelector: this.childViewSelector,
                    className: 'visible-collection',
                    collection: this.collection,
                    emptyView: this.emptyView,
                    emptyViewOptions: this.emptyViewOptions,
                    childViewOptions: this.childViewOptions,
                    loadingChildView: this.loadingChildView
                });

                this.listenTo(this.visibleCollectionView, 'childview:click', function (child) {
                    this.trigger('row:click', child.model);
                });

                this.listenTo(this.visibleCollectionView, 'childview:dblclick', function (child) {
                    this.trigger('row:dblclick', child.model);
                });

                this.visibleCollectionRegion.show(this.visibleCollectionView);
            },

            onRender: function () {
                utils.htmlHelpers.forbidSelection(this.el);
                this.__assignKeyboardShortcuts();
            },

            keyboardShortcuts: {
                'up': function (e) {
                    this.__moveToNeighbor('top', e.shiftKey);
                },
                'down': function (e) {
                    this.__moveToNeighbor('bottom', e.shiftKey);
                },
                'pageup': function (e) {
                    this.__moveToNextPage('top', e.shiftKey);
                },
                'pagedown': function (e) {
                    this.__moveToNextPage('bottom', e.shiftKey);
                },
                'home': function (e) {
                    this.__selectByIndex(this.getSelectedViewIndex(), 0, e.shiftKey);
                    this.__scrollToTop();
                },
                'end': function (e) {
                    this.__selectByIndex(this.getSelectedViewIndex(), this.collection.length - 1, e.shiftKey);
                    this.__scrollToBottom();
                }
            },

            __createReqres: function () {
                this.internalReqres = new Backbone.Wreqr.RequestResponse();
                this.internalReqres.setHandler('childViewEvent', this.__handleChildViewEvent, this);
            },

            __handleChildViewEvent: function (view, eventName, eventArguments) {
                this.trigger.apply(this, [ 'childview:' + eventName, view ].concat(eventArguments));
            },

            __scrollToTop: function () {
                var $parentEl = this.$el.parent();
                $parentEl.scrollTop(0);
            },

            __scrollToBottom : function () {
                var $parentEl = this.$el.parent();
                $parentEl.scrollTop(this.$el.height());
            },

            __scrollToNeighbor: function (index) {
                var view = this.visibleCollectionView.children.findByIndex(index),
                    $parentEl = this.$el.parent(),
                    currentScrollTop = $parentEl.scrollTop(),
                    visibleHeight = this.state.visibleHeight,
                    viewPositionTop = view.$el.position().top,
                    viewHeight = view.$el.height(),
                    viewBottomPos = viewPositionTop + viewHeight;

                if (viewBottomPos > visibleHeight) {
                    $parentEl.scrollTop(currentScrollTop + viewHeight);
                } else if (viewPositionTop &lt; 0) {
                    $parentEl.scrollTop(currentScrollTop - viewHeight);
                }
            },

            __scrollToIndex: function (index, offset) {
                var view = this.visibleCollectionView.children.findByIndex(index),
                    $parentEl = this.$el.parent(),
                    currentScrollTop = $parentEl.scrollTop(),
                    viewPositionTop = view.$el.position().top,
                    newScrollPos = offset ? currentScrollTop + viewPositionTop + offset : currentScrollTop + viewPositionTop;

                $parentEl.scrollTop(newScrollPos);
            },

            __selectByIndex: function (currentIndex, nextIndex, shiftPressed) {
                var model = this.collection.at(nextIndex);
                var selectFn = this.collection.selectSmart || this.collection.select;
                if (selectFn) {
                    selectFn.call(this.collection, model, false, shiftPressed);
                }
            },

            __moveToNeighbor: function (direction, shiftPressed) {
                var selectedIndex = this.getSelectedViewIndex(),
                    nextIndex = selectedIndex;

                direction === 'top' ? nextIndex-- : nextIndex++; //jshint ignore: line

                if (nextIndex !== selectedIndex) {
                    nextIndex = this.__normalizeCollectionIndex(nextIndex);
                    this.__selectByIndex(selectedIndex, nextIndex, shiftPressed);
                    this.__scrollToNeighbor(nextIndex);
                }
            },

            __moveToNextPage: function (direction, shiftPressed) {
                var selectedIndex = this.getSelectedViewIndex(),
                    selectedView = this.visibleCollectionView.children.findByIndex(selectedIndex),
                    selectedPositionTop = selectedView.$el.position().top,
                    nextIndex = selectedIndex;

                if (direction === 'top') {
                    nextIndex = this.__getTopIndex(selectedIndex);
                } else {
                    nextIndex = this.__getBottomIndex(selectedIndex);
                }

                if (nextIndex !== selectedIndex) {
                    nextIndex = this.__normalizeCollectionIndex(nextIndex);
                    this.__selectByIndex(selectedIndex, nextIndex, shiftPressed);
                    this.__scrollToIndex(nextIndex, -selectedPositionTop);
                }
            },

            getSelectedViewIndex: function () {
                var cid = this.collection.cursorCid;
                var index = 0;
                this.collection.find(function (x, i) {
                    if (x.cid === cid) {
                        index = i;
                        return true;
                    }
                });

                return index;
            },

            __getTopIndex: function (index) {
                var cHeight = 0,
                    newIndex = index,
                    childViews = this.visibleCollectionView.children.toArray();

                for (var i = index - 1; i >= 0; i--) {
                    var newH = cHeight + childViews[i].$el.height();

                    if (newH > this.state.visibleHeight) {
                        break;
                    } else {
                        newIndex = i;
                        cHeight = newH;
                    }
                }

                return newIndex;
            },

            __getBottomIndex: function (index) {
                var cHeight = 0,
                    newIndex = index,
                    childViews = this.visibleCollectionView.children.toArray();

                for (var i = index + 1; i &lt; childViews.length; i++) {
                    var newH = cHeight + childViews[i].$el.height();

                    if (newH > this.state.visibleHeight) {
                        break;
                    } else {
                        newIndex = i;
                        cHeight = newH;
                    }
                }

                return newIndex;
            },

            // normalized the index so that it fits in range [0, this.collection.length - 1]
            __normalizeCollectionIndex: function (index) {
                return Math.max(0, Math.min(this.collection.length - 1, index));
            },

            __assignKeyboardShortcuts: function () {
                if (this.keyListener) {
                    this.keyListener.reset();
                }
                this.keyListener = new lib.keypress.Listener(this.el);
                _.each(this.keyboardShortcuts, function (value, key) //noinspection JSHint
                {
                    if (typeof value === 'object') {
                        this.keyListener.register_combo(_.extend({
                            'keys': key,
                            'this': this
                        }, value));
                    } else {
                        this.keyListener.simple_combo(key, value.bind(this));
                    }
                }, this);
            },

            getElementHeight: function () {
                var minHeight = 0;

                if (this.visibleCollectionView && this.visibleCollectionView.isEmpty()) {
                    minHeight = this.visibleCollectionView.$el.find('.empty-view').height();
                } else {
                    this.visibleCollectionView.children.forEach(function (view) {
                        minHeight += view.$el.height();
                    });
                }

                return minHeight;
            },

            setWidth: function (fullWidth) {
                this.$el.width(fullWidth);
            },

            setFitToView: function () {
                this.visibleCollectionView.setFitToView();
            },

            __handleResize: function () {
                this.__handleResizeInternal();
            },

            __handleResizeInternal: function () {
                this.state.visibleHeight = this.$el.parent().height();

                setTimeout(function () {
                    var fullWidth = this.$el.parent().width(),
                        currentWidth = this.$el.width();

                    if (fullWidth > currentWidth) {
                        this.$el.width(fullWidth);
                    }
                }.bind(this), 200);
            }
        });

        return ListView;
    });
</pre>
	</article>
</section>





				</div>

				<div class="clearfix"></div>
				<footer>
					
					
		<span class="copyright">
		Comindware Copyright © 2015
		</span>
					<br />
					
		<span class="jsdoc-message">
		Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a>
		on Thu Dec 17th 2015 using the <a
			href="https://github.com/terryweiss/docstrap">DocStrap template</a>.
		</span>
				</footer>
			</div>

			
			<br clear="both">
		</div>

	</div>
	<!--<script src="scripts/sunlight.js"></script>-->
	<script src="scripts/docstrap.lib.js"></script>
	<script src="scripts/bootstrap-dropdown.js"></script>
	<script src="scripts/toc.js"></script>

	<script>
		$( function () {
			$( "[id*='$']" ).each( function () {
				var $this = $( this );

				$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
			} );

			$( "#toc" ).toc( {
				anchorName  : function ( i, heading, prefix ) {
					return $( heading ).attr( "id" ) || ( prefix + i );
				},
				selectors   : "h1,h2,h3,h4",
				showAndHide : false,
				scrollTo    : "100px"
			} );

			$( "#toc>ul" ).addClass( "nav nav-pills nav-stacked" );
			$( "#main span[id^='toc']" ).addClass( "toc-shim" );
			$( '.dropdown-toggle' ).dropdown();
//			$( ".tutorial-section pre, .readme-section pre" ).addClass( "sunlight-highlight-javascript" ).addClass( "linenums" );

			$( ".tutorial-section pre, .readme-section pre" ).each( function () {
				var $this = $( this );

				var example = $this.find( "code" );
				exampleText = example.html();
				var lang = /{@lang (.*?)}/.exec( exampleText );
				if ( lang && lang[1] ) {
					exampleText = exampleText.replace( lang[0], "" );
					example.html( exampleText );
					lang = lang[1];
				} else {
					lang = "javascript";
				}

				if ( lang ) {

					$this
						.addClass( "sunlight-highlight-" + lang )
						.addClass( "linenums" )
						.html( example.html() );

				}
			} );

			Sunlight.highlightAll( {
				lineNumbers : true,
				showMenu : true,
				enableDoclinks : true
			} );
		} );
	 </script>



	<!--Navigation and Symbol Display-->
	


	<!--Google Analytics-->
	

</body>
</html>
